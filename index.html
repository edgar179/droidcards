<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cartas de Droids</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
body { font-family: 'Inter', sans-serif; background-color:#0d1117; color:#c9d1d9; padding:2rem; min-height:100vh; }
.header-container { display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem; max-width:1200px; margin:0 auto; }
.user-id-display { font-size:0.875rem; color:#8b949e; background-color:#161b22; padding:0.5rem 1rem; border-radius:0.5rem; border:1px solid #30363d; }
.add-card-button { background-color:#216e39; color:#c9d1d9; padding:0.75rem 1.5rem; border-radius:0.5rem; font-weight:600; cursor:pointer; display:flex; align-items:center; gap:0.5rem; transition:background-color 0.2s; }
.add-card-button:hover { background-color:#2e8b57; }
.card-container { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:2rem; max-width:1200px; margin:0 auto; }
.droid-card { background-color:#161b22; border:1px solid #30363d; border-radius:1rem; padding:1.5rem; display:flex; flex-direction:column; position:relative; box-shadow:0 4px 15px rgba(0,0,0,0.4); transition:transform 0.3s ease, box-shadow 0.3s ease; }
.droid-card:hover { transform:translateY(-5px); box-shadow:0 8px 20px rgba(0,0,0,0.6); }
.card-header { display:flex; align-items:center; margin-bottom:1rem; }
.card-icon-container { margin-right:1rem; width:4rem; height:4rem; display:flex; justify-content:center; align-items:center; background-color:#1f2a37; border-radius:50%; overflow:hidden; flex-shrink:0; }
.card-icon-container i { font-size:2.5rem; color:#58a6ff; }
.card-title { font-size:1.5rem; font-weight:700; color:#58a6ff; }
.card-subtitle { font-size:1rem; font-weight:500; color:#8b949e; }
.card-section { margin-bottom:1rem; }
.card-label { font-weight:600; color:#c9d1d9; }
.card-text { color:#8b949e; font-size:0.9rem; }
.edit-button, .delete-button { position:absolute; top:1rem; background:transparent; border:none; cursor:pointer; font-size:1.25rem; color:#8b949e; transition:color 0.2s; }
.delete-button { right:3.5rem; }
.edit-button { right:1rem; }
.edit-button:hover { color:#58a6ff; }
.delete-button:hover { color:#ff7b72; }
.modal { display:none; position:fixed; z-index:100; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,0.6); justify-content:center; align-items:center; }
.modal-content { background-color:#1f2a37; padding:2rem; border-radius:1rem; width:700px; height:600px; box-shadow:0 4px 15px rgba(0,0,0,0.6); border:1px solid #30363d; overflow-y:auto; }
.modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem; }
.modal-title { font-size:1.5rem; font-weight:700; color:#c9d1d9; }
.modal-input { width:100%; padding:0.75rem; margin-bottom:1rem; border-radius:0.5rem; background-color:#0d1117; border:1px solid #30363d; color:#c9d1d9; resize:vertical; }
.modal-buttons { display:flex; justify-content:flex-end; gap:1rem; }
.modal-button { padding:0.75rem 1.5rem; border-radius:0.5rem; font-weight:600; transition:background-color 0.2s; }
.modal-button:disabled { background-color:#161b22; cursor:not-allowed; color:#8b949e; }
</style>
</head>
<body>
<div class="header-container">
<button id="addCardBtn" class="add-card-button"><i class="fas fa-plus-circle"></i> Criar Droid</button>
<div id="userIdDisplay" class="user-id-display"></div>
</div>
<div id="card-container" class="card-container"></div>

<!-- Modal -->
<div id="editModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h2 id="modalTitle" class="modal-title">Editar Droid</h2>
<button id="closeModalBtn" class="edit-button"><i class="fas fa-times"></i></button>
</div>
<label>Nome:</label>
<input type="text" id="edit-name" class="modal-input">
<label>Diretrizes:</label>
<textarea id="edit-directives" rows="3" class="modal-input"></textarea>
<label>Cadeia de Comando:</label>
<textarea id="edit-command-chain" rows="3" class="modal-input"></textarea>
<div class="modal-buttons">
<button id="saveBtn" class="modal-button bg-blue-600 text-white hover:bg-blue-700">Salvar</button>
<button id="cancelBtn" class="modal-button bg-gray-500 text-white hover:bg-gray-600">Cancelar</button>
</div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
import { getFirestore, collection, doc, addDoc, updateDoc, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

// Firebase Config (substitua pelo seu snippet do Firebase)
const firebaseConfig = {
  apiKey: "AIzaSyDgQP8wAX81LSM3I4fyj6GA5HWcPNiuBBs",
  authDomain: "droidcards-5367f.firebaseapp.com",
  projectId: "droidcards-5367f",
  storageBucket: "droidcards-5367f.firebasestorage.app",
  messagingSenderId: "149545333964",
  appId: "1:149545333964:web:74bd91c26fb82abc7f7e69"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let userId = null;
let currentDroidDocId = null;

const container = document.getElementById('card-container');
const modal = document.getElementById('editModal');
const saveBtn = document.getElementById('saveBtn');
const cancelBtn = document.getElementById('cancelBtn');
const closeModalBtn = document.getElementById('closeModalBtn');
const addCardBtn = document.getElementById('addCardBtn');

onAuthStateChanged(auth, async (user)=>{
  if(user){
    userId = user.uid;
    document.getElementById('userIdDisplay').textContent = `ID do UsuÃ¡rio: ${userId}`;
    listenDroids();
  } else {
    await signInAnonymously(auth);
  }
});

function listenDroids(){
  const droidsRef = collection(db, `artifacts/app/public/data/droids`);
  onSnapshot(droidsRef, (snapshot)=>{
    container.innerHTML = '';
    snapshot.forEach(docSnap=>{
      const data = docSnap.data();
      const card = document.createElement('div');
      card.className = 'droid-card';
      card.innerHTML = `
        <div class="card-header">
          <div class="card-icon-container">
            <i class="fas fa-robot"></i>
          </div>
          <div>
            <div class="card-title">${data.name || 'Sem Nome'}</div>
          </div>
        </div>
        <div class="card-section"><div class="card-label">Diretrizes:</div><div class="card-text">${data.directives||''}</div></div>
        <div class="card-section"><div class="card-label">Cadeia de Comando:</div><div class="card-text">${data.commandChain||''}</div></div>
        <button class="edit-button"><i class="fas fa-edit"></i></button>
        <button class="delete-button"><i class="fas fa-trash"></i></button>
      `;
      card.querySelector('.edit-button').onclick = ()=> openModal(docSnap.id, data);
      card.querySelector('.delete-button').onclick = ()=> deleteDroid(docSnap.id);
      container.appendChild(card);
    });
  });
}

addCardBtn.onclick = ()=> openModal();

function openModal(docId=null, data={}){
  currentDroidDocId = docId;
  modal.style.display = 'flex';
  document.getElementById('modalTitle').textContent = docId?'Editar Droid':'Criar Droid';
  document.getElementById('edit-name').value = data.name||'';
  document.getElementById('edit-directives').value = data.directives||'';
  document.getElementById('edit-command-chain').value = data.commandChain||'';
}

function closeModal(){
  modal.style.display = 'none';
}

saveBtn.onclick = async ()=>{
  const name = document.getElementById('edit-name').value;
  const directives = document.getElementById('edit-directives').value;
  const commandChain = document.getElementById('edit-command-chain').value;
  const data = { name, directives, commandChain };
  if(currentDroidDocId){
    const dRef = doc(db, `artifacts/app/public/data/droids`, currentDroidDocId);
    await updateDoc(dRef, data);
  } else {
    const dRef = collection(db, `artifacts/app/public/data/droids`);
    await addDoc(dRef, data);
  }
  closeModal();
}

cancelBtn.onclick = closeModal;
closeModalBtn.onclick = closeModal;

async function deleteDroid(docId){
  const dRef = doc(db, `artifacts/app/public/data/droids`, docId);
  await deleteDoc(dRef);
}
</script>
</body>
</html>

